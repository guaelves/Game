<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>åœæ£‹ AI</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    background-color: #f5deb3;
  }
  canvas {
    background-color: #F0D9B5;
    width: 90vmin; height: 90vmin;
    touch-action: none;
  }
  #controls {
    display: flex; flex-wrap: wrap;
    gap: 10px; margin: 10px 0;
    font-family: "Noto Sans TC", sans-serif;
    justify-content: center;
  }
  #status, #winnerText, #capturedText, #stoneCount {
    font-family: "Noto Sans TC", sans-serif;
    font-size: 1.1em; color: #333;
    margin: 4px 0;
  }
  button { cursor: pointer; }
</style>
</head>
<body>
<canvas id="goBoard"></canvas>
<div id="controls">
  <label>éŠæˆ²æ¨¡å¼ï¼š
    <select id="gameMode">
      <option value="single" selected>å–®äººå° AI</option>
      <option value="two">é›™äººå°æˆ°</option>
    </select>
  </label>
  <label>æ£‹ç›¤æ ¼æ•¸ï¼š
    <select id="boardSizeSelect">
      <option value="19">19 è·¯æ£‹ç›¤</option>
      <option value="13" selected>13 è·¯æ£‹ç›¤</option>
      <option value="9">9 è·¯æ£‹ç›¤</option>
    </select>
  </label>
  <label>AI é›£åº¦ï¼š
    <select id="aiLevel">
      <option value="easy">åˆç´š</option>
      <option value="medium" selected>ä¸­ç´š</option>
      <option value="pro">è·æ¥­ç´š</option>
    </select>
  </label>
  <label>è²¼ç›® (ç™½æ£‹è£œå„Ÿ)ï¼š 
    <input id="komiInput" type="number" value="6.5" step="0.5" style="width:60px"> ç›®
  </label>
  <button onclick="resetGame()">é‡æ–°é–‹å§‹</button>
  <button onclick="checkWinner()">ğŸ§® è¨ˆç®—å‹è² </button>
</div>
<div id="status">ğŸŸ¢ é»‘æ£‹ä¸‹å­ä¸­</div>
<div id="capturedText">é»‘æ£‹è¢«æï¼š0  ç™½æ£‹è¢«æï¼š0</div>
<div id="stoneCount">é»‘æ£‹æ•¸é‡ï¼š0  ç™½æ£‹æ•¸é‡ï¼š0</div>
<div id="winnerText"></div>

<script>
let BOARD_SIZE = 19;
let board, koPoint = null;
let komi = 6.5;
let capturedBlack = 0, capturedWhite = 0;

let canvas = document.getElementById('goBoard');
let ctx = canvas.getContext('2d');
let statusText = document.getElementById('status');
let winnerText = document.getElementById('winnerText');
let capturedText = document.getElementById('capturedText');
let stoneCountText = document.getElementById('stoneCount');
let aiLevel = document.getElementById('aiLevel');
let boardSizeSelect = document.getElementById('boardSizeSelect');
let komiInput = document.getElementById('komiInput');
let gameMode = document.getElementById('gameMode');

let CELL_SIZE, STONE_RADIUS;
let isAIMoving = false;
let lastMove = null;
let currentPlayer = 1;

function initBoard(size){
  BOARD_SIZE = size;
  board = Array.from({length: BOARD_SIZE},()=>Array(BOARD_SIZE).fill(0));
  koPoint = null;
  lastMove = null;
  currentPlayer = 1;
  capturedBlack = 0;
  capturedWhite = 0;
  resizeCanvas();
  drawBoard();
  statusText.textContent = "ğŸŸ¢ é»‘æ£‹ä¸‹å­ä¸­";
  winnerText.textContent = "";
  capturedText.textContent = `é»‘æ£‹è¢«æï¼š${capturedBlack}  ç™½æ£‹è¢«æï¼š${capturedWhite}`;
  stoneCountText.textContent = `é»‘æ£‹æ•¸é‡ï¼š0  ç™½æ£‹æ•¸é‡ï¼š0`;
  isAIMoving = false;
}

function resizeCanvas(){
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
  CELL_SIZE = canvas.width / BOARD_SIZE;
  STONE_RADIUS = CELL_SIZE/2 - 2;
  drawBoard();
}
window.addEventListener('resize', resizeCanvas);

function drawBoard(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle = '#000'; ctx.lineWidth = 1;

  for(let i=0;i<BOARD_SIZE;i++){
    ctx.beginPath();
    ctx.moveTo(CELL_SIZE/2, CELL_SIZE/2+i*CELL_SIZE);
    ctx.lineTo(CELL_SIZE/2+(BOARD_SIZE-1)*CELL_SIZE, CELL_SIZE/2+i*CELL_SIZE);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(CELL_SIZE/2+i*CELL_SIZE, CELL_SIZE/2);
    ctx.lineTo(CELL_SIZE/2+i*CELL_SIZE, CELL_SIZE/2+(BOARD_SIZE-1)*CELL_SIZE);
    ctx.stroke();
  }

  let stars = [];
  if (BOARD_SIZE === 19) stars = [3,9,15];
  else if (BOARD_SIZE === 13) stars = [3,6,9];
  else if (BOARD_SIZE === 9) stars = [2,4,6];
  ctx.fillStyle = '#000';
  for(let i of stars){
    for(let j of stars){
      ctx.beginPath();
      ctx.arc(CELL_SIZE/2+i*CELL_SIZE, CELL_SIZE/2+j*CELL_SIZE,3,0,2*Math.PI);
      ctx.fill();
    }
  }

  for(let r=0;r<BOARD_SIZE;r++){
    for(let c=0;c<BOARD_SIZE;c++){
      if(board[r][c]!==0){
        ctx.beginPath();
        ctx.arc(CELL_SIZE/2+c*CELL_SIZE, CELL_SIZE/2+r*CELL_SIZE, STONE_RADIUS,0,2*Math.PI);
        ctx.fillStyle = board[r][c]===1?'black':'white';
        ctx.fill();
      }
    }
  }

  if(lastMove){
    let [lr, lc] = lastMove;
    ctx.beginPath();
    ctx.arc(CELL_SIZE/2 + lc*CELL_SIZE, CELL_SIZE/2 + lr*CELL_SIZE, STONE_RADIUS + 2, 0, 2*Math.PI);
    ctx.lineWidth = 3; ctx.strokeStyle = 'yellow'; ctx.stroke();
  }

  if(koPoint){
    ctx.beginPath();
    ctx.arc(CELL_SIZE/2 + koPoint[1]*CELL_SIZE, CELL_SIZE/2 + koPoint[0]*CELL_SIZE, 5, 0, 2*Math.PI);
    ctx.fillStyle = 'red'; ctx.fill();
  }

  updateStoneCount();
}

function updateStoneCount(){
  let blackCount = 0, whiteCount = 0;
  for(let r=0;r<BOARD_SIZE;r++){
    for(let c=0;c<BOARD_SIZE;c++){
      if(board[r][c]===1) blackCount++;
      if(board[r][c]===2) whiteCount++;
    }
  }
  stoneCountText.textContent = `é»‘æ£‹æ•¸é‡ï¼š${blackCount}  ç™½æ£‹æ•¸é‡ï¼š${whiteCount}`;
}

function placeStone(r,c,color){
  if(r<0||c<0||r>=BOARD_SIZE||c>=BOARD_SIZE) return false;
  if(board[r][c]!==0) return false;

  // âœ… æ”¹ï¼šå…è¨±è‡ªç”±ä¸‹å­ï¼Œä¸å†ç¦æ­¢æ‰“åŠ«æˆ–æ°£ç›¡
  board[r][c]=color;
  lastMove=[r,c];
  return true;
}

// === AI ===
function aiMove(){
  isAIMoving=true;
  let empties=[];
  for(let r=0;r<BOARD_SIZE;r++)
    for(let c=0;c<BOARD_SIZE;c++)
      if(board[r][c]===0)
        empties.push([r,c]);
  if(empties.length===0){ isAIMoving=false; return; }

  // ç°¡å–®éš¨æ©Ÿä¸‹å­ï¼ˆé¿å…å¡æ­»ï¼‰
  let [r,c]=empties[Math.floor(Math.random()*empties.length)];
  placeStone(r,c,2);
  drawBoard();
  statusText.textContent="ğŸŸ¢ é»‘æ£‹ä¸‹å­ä¸­";
  isAIMoving=false;
}

// === äº‹ä»¶ ===
canvas.addEventListener('click', e=>{
  if(isAIMoving) return;
  let rect = canvas.getBoundingClientRect();
  let x = e.clientX - rect.left;
  let y = e.clientY - rect.top;
  let c = Math.round((x - CELL_SIZE/2)/CELL_SIZE);
  let r = Math.round((y - CELL_SIZE/2)/CELL_SIZE);

  if(gameMode.value==='single'){
    if(placeStone(r,c,1)){
      drawBoard();
      statusText.textContent="ğŸ”µ AI ä¸‹å­ä¸­...";
      setTimeout(aiMove,300);
    }
  } else {
    if(placeStone(r,c,currentPlayer)){
      drawBoard();
      currentPlayer=3-currentPlayer;
      statusText.textContent=currentPlayer===1?"ğŸŸ¢ é»‘æ£‹ä¸‹å­ä¸­":"âšª ç™½æ£‹ä¸‹å­ä¸­";
    }
  }
});

function resetGame(){
  let size=parseInt(boardSizeSelect.value);
  komi=parseFloat(komiInput.value);
  initBoard(size);
}

function checkWinner(){
  let black=0,white=komi;
  for(let r=0;r<BOARD_SIZE;r++)
    for(let c=0;c<BOARD_SIZE;c++){
      if(board[r][c]===1) black++;
      if(board[r][c]===2) white++;
    }
  let winner = black>white ? "é»‘æ£‹å‹" : (white>black ? "ç™½æ£‹å‹" : "å¹³æ‰‹");
  winnerText.textContent = `ğŸ§® å‹è² è¨ˆç®—: é»‘ ${black}  ç™½ ${white}  â‡’ ${winner}`;
}

initBoard(parseInt(boardSizeSelect.value));
</script>
</body>
</html>
