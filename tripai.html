<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ…¢æ—…æ—¥è¨˜ | AI </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&display=swap');
        [v-cloak] { display: none; }
        body { font-family: 'Noto Serif TC', serif; background-color: #f4f1ee; color: #1e293b; }
        .card-elegant { background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(100, 116, 139, 0.4); border-radius: 1rem; }
        .tab-active { border-bottom: 2px solid #1e293b; color: #000; font-weight: 700; }
        th, td { border: 1px solid #e2e8f0; padding: 6px; text-align: center; font-size: 11px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-[#f4f1ee]">

<div id="app" v-cloak class="max-w-md mx-auto min-h-screen flex flex-col bg-[#fdfaf7] shadow-2xl relative">
    
    <div v-if="!currentTripId && !showAiGenerator" class="p-8 space-y-8">
        <header>
            <h1 class="text-3xl font-bold tracking-widest">æˆ‘çš„æ—…ç¨‹</h1>
            <p class="text-[10px] text-slate-500 mt-2 font-bold tracking-widest uppercase">AI Route Planner V5.2</p>
        </header>
        
        <button @click="showAiGenerator = true" class="w-full py-8 bg-slate-800 rounded-2xl text-white font-bold shadow-xl flex flex-col items-center border-b-4 border-slate-900 active:translate-y-1">
            <span class="text-lg">âœ¨ AI æ™ºèƒ½è·¯é †è¦åŠƒ</span>
            <span class="text-[10px] opacity-80 mt-1">è¼¸å…¥åœ°é»ï¼Œè‡ªå‹•åˆ¤æ–·å€åŸŸèˆ‡è·¯é †</span>
        </button>

        <div class="space-y-4">
            <div v-for="(trip, id) in allTrips" :key="id" 
                class="card-elegant p-6 flex justify-between items-center cursor-pointer border-l-8 border-l-slate-600 relative group">
                <div @click="openTrip(id)" class="flex-1">
                    <h2 class="text-lg font-bold">{{ trip.info.title }}</h2>
                    <p class="text-xs text-slate-500">{{ trip.days.length }} Days Trip</p>
                </div>
                <div class="flex items-center gap-4">
                    <button @click.stop="deleteTrip(id)" class="text-red-400 hover:text-red-600 text-sm p-2">
                        ğŸ—‘ï¸
                    </button>
                    <span class="text-slate-300" @click="openTrip(id)">â¯</span>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showAiGenerator" class="p-8 space-y-6">
        <button @click="showAiGenerator = false" class="text-slate-500 text-sm font-bold">â® è¿”å›</button>
        <h2 class="text-2xl font-bold">AI æ™ºèƒ½è¦åŠƒå¼•æ“</h2>
        <div class="space-y-5">
            <div>
                <label class="text-xs font-bold text-slate-400">ç›®çš„åœ°èˆ‡å¤©æ•¸</label>
                <div class="flex gap-2 mt-1">
                    <input v-model="aiForm.city" class="flex-1 p-3 border rounded-xl bg-white" placeholder="åŸå¸‚(å¦‚:å¤§é˜ª)">
                    <input type="number" v-model="aiForm.days" class="w-20 p-3 border rounded-xl bg-white text-center" placeholder="å¤©æ•¸">
                </div>
            </div>
            <div>
                <label class="text-xs font-bold text-slate-400">æƒ³å»çš„åœ°é» (é¸å¡«ï¼Œè‹¥ç©ºç™½å‰‡è‡ªå‹•æ¨è–¦)</label>
                <textarea v-model="aiForm.wishlist" class="w-full p-3 border rounded-xl bg-white mt-1 text-sm" rows="5" placeholder="ä¾‹å¦‚ï¼šç’°çƒå½±åŸã€æ¸…æ°´å¯ºã€å¿ƒé½‹æ©‹..."></textarea>
            </div>
            <button @click="generateTrip" class="w-full py-4 bg-blue-900 text-white rounded-xl font-bold shadow-lg">ğŸš€ åˆ¤æ–·è·¯é †ä¸¦ç”Ÿæˆè¡Œç¨‹</button>
        </div>
    </div>

    <template v-if="currentTripId">
        <header class="pt-10 pb-4 px-8 sticky top-0 z-50 bg-[#fdfaf7]/95 backdrop-blur-md border-b">
            <div class="flex justify-between items-center mb-6">
                <button @click="currentTripId = null" class="text-xs font-bold text-slate-500">â® è¿”å›</button>
                <button @click="saveData" class="text-xs font-bold text-emerald-700 underline">ğŸ’¾ å„²å­˜æ‰€æœ‰è®Šæ›´</button>
            </div>
            <nav class="flex overflow-x-auto gap-5 no-scrollbar text-xs">
                <button v-for="(label, key) in tabs" :key="key" @click="tab = key" :class="tab === key ? 'tab-active' : ''"
                    class="pb-2 whitespace-nowrap font-bold text-slate-500">{{ label }}</button>
            </nav>
        </header>

        <main class="flex-1 px-4 pb-24 mt-4 overflow-y-auto">
            <div v-if="tab === 'info'" class="space-y-4">
                <div class="card-elegant p-4">
                    <label class="text-[10px] text-slate-400 font-bold uppercase">æ—…ç¨‹åç¨±</label>
                    <input v-model="currentTrip.info.title" class="w-full font-bold outline-none">
                </div>
                <div class="card-elegant p-4">
                    <label class="text-[10px] text-slate-400 font-bold mb-2 block uppercase">âœˆï¸ èˆªç­æ˜ç´° FLIGHT</label>
                    <table class="w-full border-collapse">
                        <thead>
                            <tr><th>è¡Œç¨‹</th><th>æ—¥æœŸ</th><th>æ™‚é–“</th><th>èˆªç­</th></tr>
                        </thead>
                        <tbody>
                            <tr v-for="f in ['go', 'back']" :key="f">
                                <td class="font-bold text-slate-500">{{ f==='go'?'å»ç¨‹':'å›ç¨‹' }}</td>
                                <td><input v-model="currentTrip.flightData[f].date" class="w-full text-center text-[10px]"></td>
                                <td><input v-model="currentTrip.flightData[f].time" class="w-full text-center text-[10px]"></td>
                                <td><input v-model="currentTrip.flightData[f].no" class="w-full text-center text-[10px]"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="card-elegant p-4">
                    <label class="text-[10px] text-slate-400 font-bold uppercase">ğŸ¨ é£¯åº—ç´°ç¯€</label>
                    <textarea v-model="currentTrip.info.hotel" class="w-full text-sm font-bold mt-1 outline-none" rows="3"></textarea>
                </div>
            </div>

            <div v-if="tab === 'plan'" class="space-y-4">
                <div class="flex gap-2 overflow-x-auto no-scrollbar py-2">
                    <button v-for="(day, i) in currentTrip.days" @click="curDay = i"
                        :class="curDay === i ? 'bg-slate-800 text-white' : 'bg-stone-200'"
                        class="flex-shrink-0 w-10 h-10 rounded-full text-xs font-bold">D{{i+1}}</button>
                </div>
                <div v-for="(act, idx) in currentTrip.days[curDay].activities" :key="idx" class="card-elegant p-4 relative">
                    <button @click="currentTrip.days[curDay].activities.splice(idx, 1)" class="absolute top-2 right-2 text-slate-300">âœ•</button>
                    <div class="flex items-center gap-2 mb-2">
                        <input v-model="act.time" class="w-12 text-sm font-bold" placeholder="00:00">
                        <input v-model="act.loc" class="flex-1 font-bold border-b text-sm" placeholder="åœ°é»åç¨±">
                    </div>
                    <div v-if="act.loc" class="mb-2">
                        <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(act.loc)" target="_blank" class="text-[10px] text-blue-700 font-bold bg-blue-50 px-2 py-1 rounded border border-blue-100">ğŸ“ åœ¨åœ°åœ–ä¸­é–‹å•Ÿ Google Map</a>
                    </div>
                    <textarea v-model="act.note" class="w-full text-[11px] text-slate-500 bg-stone-50 p-2 rounded" rows="1" placeholder="å‚™è¨»..."></textarea>
                </div>
                <button @click="addAct" class="w-full py-4 border-2 border-dashed rounded-xl text-slate-400 text-xs">+ æ–°å¢æ´»å‹•é …ç›®</button>
            </div>

            <div v-if="tab === 'vault'" class="space-y-6">
                <div v-for="cat in vaultCategories" :key="cat.key" class="space-y-3">
                    <h3 class="text-xs font-bold text-slate-500 border-l-4 pl-2 border-slate-400">{{ cat.label }}</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="(img, ii) in currentTrip.vault[cat.key]" :key="ii" class="relative">
                            <img :src="img" class="w-full aspect-video object-cover rounded-lg">
                            <button @click="currentTrip.vault[cat.key].splice(ii,1)" class="absolute -top-1 -right-1 bg-black text-white rounded-full w-5 h-5 text-xs">âœ•</button>
                        </div>
                        <label class="aspect-video border-2 border-dashed rounded-lg flex flex-col items-center justify-center bg-white cursor-pointer text-slate-400">
                            <span class="text-lg">+</span>
                            <span class="text-[9px]">é€£é¸å¤šå¼µ</span>
                            <input type="file" class="hidden" accept="image/*" multiple @change="uploadVaultImgs($event, cat.key)">
                        </label>
                    </div>
                </div>
            </div>

            <div v-if="tab === 'pack'" class="space-y-4">
                <div v-for="(items, category) in currentTrip.packs" :key="category" class="card-elegant p-4">
                    <h4 class="text-xs font-bold text-slate-500 mb-2 border-b">{{ category }}</h4>
                    <div v-for="(p, i) in items" :key="i" class="flex items-center gap-2 py-1">
                        <input type="checkbox" v-model="p.done">
                        <input v-model="p.text" class="flex-1 text-sm font-bold outline-none" :class="p.done?'line-through text-slate-300':''">
                        <button @click="items.splice(i,1)" class="text-slate-300">âœ•</button>
                    </div>
                    <button @click="items.push({text:'', done:false})" class="mt-2 text-[10px] text-blue-500">+ æ–°å¢é …ç›®</button>
                </div>
            </div>
        </main>
    </template>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

createApp({
    setup() {
        const currentTripId = ref(null);
        const allTrips = ref({});
        const tab = ref('info');
        const curDay = ref(0);
        const showAiGenerator = ref(false);
        const aiForm = ref({ city: 'å¤§é˜ª', days: 4, wishlist: '' });

        const tabs = { info: 'æ¦‚è¦½/èˆªç­', plan: 'æ—¥éŠè¦åŠƒ', vault: 'æ–‡ä»¶å‚™ä»½', pack: 'è¡Œææ¸…å–®' };
        const vaultCategories = [{label:'æ©Ÿç¥¨æ–‡ä»¶', key:'flight'}, {label:'é£¯åº—æ–‡ä»¶', key:'hotel'}, {label:'æ†‘è­‰/VJW', key:'vjw'}];

        const geoDb = {
            'äº¬éƒ½': ['æ¸…æ°´å¯º', 'ä¼è¦‹', 'ç¨»è·', 'åµå±±', 'é‡‘é–£å¯º', 'ç¥‡åœ’', 'æ²³åŸç”º', 'äºŒæ¢åŸ'],
            'ç’°çƒ': ['ç’°çƒå½±åŸ', 'USJ', 'ç‘ªåˆ©æ­', 'å“ˆåˆ©æ³¢ç‰¹'],
            'ç¥æˆ¶': ['ç¥æˆ¶', 'åŒ—é‡ç•°äººé¤¨', 'å…­ç”²å±±', 'æœ‰é¦¬æº«æ³‰'],
            'å¥ˆè‰¯': ['å¥ˆè‰¯', 'é¹¿', 'æ±å¤§å¯º', 'æ˜¥æ—¥å¤§ç¤¾'],
            'å¸‚å€': ['å¿ƒé½‹æ©‹', 'é“é “å €', 'é»‘é–€å¸‚å ´', 'é€šå¤©é–£', 'å¤§é˜ªåŸ', 'æ¢…ç”°', 'è—å¤©å¤§å»ˆ']
        };

        const currentTrip = computed(() => allTrips.value[currentTripId.value]);

        const generateTrip = () => {
            const id = 'trip_' + Date.now();
            const daysCount = parseInt(aiForm.value.days);
            const daysArr = Array.from({length: daysCount}, () => ({ activities: [] }));
            
            let items = aiForm.value.wishlist.split(/[ï¼Œ,ã€\s\n]+/).filter(i => i.trim());
            if (items.length === 0 && aiForm.value.city.includes('å¤§é˜ª')) {
                items = ['é»‘é–€å¸‚å ´', 'å¤§é˜ªåŸ', 'å¿ƒé½‹æ©‹', 'ç’°çƒå½±åŸ', 'æ¸…æ°´å¯º', 'ä¼è¦‹ç¨»è·å¤§ç¤¾', 'å¥ˆè‰¯å…¬åœ’', 'æ¢…ç”°è—å¤©å¤§å»ˆ'];
            }

            items.forEach((item) => {
                let dIdx = 0;
                if (geoDb['äº¬éƒ½'].some(k => item.includes(k))) dIdx = Math.min(1, daysCount-1);
                else if (geoDb['ç’°çƒ'].some(k => item.includes(k))) dIdx = Math.min(2, daysCount-1);
                else if (geoDb['å¥ˆè‰¯'].some(k => item.includes(k))) dIdx = Math.min(3, daysCount-1);
                else dIdx = 0;

                daysArr[dIdx].activities.push({ time: '10:00', loc: item, note: 'AI å»ºè­°è¡Œç¨‹' });
            });

            allTrips.value[id] = {
                info: { title: `${aiForm.value.city}${daysCount}æ—¥éŠ`, hotel: '' },
                flightData: { go: {date:'',time:'',no:''}, back: {date:'',time:'',no:''} },
                days: daysArr,
                vault: { flight: [], hotel: [], vjw: [] },
                packs: { 'å¿…å‚™è­‰ä»¶': [{text:'è­·ç…§',done:false}, {text:'æ—¥å¹£',done:false}], 'å€‹äººç”¨å“': [{text:'è¡£ç‰©',done:false}] }
            };
            currentTripId.value = id;
            showAiGenerator.value = false;
            saveDataSilent();
        };

        onMounted(() => {
            const saved = localStorage.getItem('travel_v5_2_geo');
            if (saved) allTrips.value = JSON.parse(saved);
        });

        const uploadVaultImgs = (e, key) => {
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => currentTrip.value.vault[key].push(ev.target.result);
                reader.readAsDataURL(file);
            });
        };

        const openTrip = (id) => { currentTripId.value = id; tab.value = 'info'; };
        const addAct = () => currentTrip.value.days[curDay.value].activities.push({time:'', loc:'', note:''});
        
        // åˆªé™¤è¡Œç¨‹åŠŸèƒ½
        const deleteTrip = (id) => {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¡Œç¨‹å—ï¼Ÿåˆªé™¤å¾Œç„¡æ³•é‚„åŸã€‚')) {
                delete allTrips.value[id];
                saveDataSilent();
            }
        };

        // éœé»˜å„²å­˜ï¼ˆä¸è·³æç¤ºï¼‰
        const saveDataSilent = () => {
            localStorage.setItem('travel_v5_2_geo', JSON.stringify(allTrips.value));
        };

        // å¸¶æç¤ºçš„å„²å­˜
        const saveData = () => { 
            saveDataSilent();
            alert('ğŸ’¾ æ•¸æ“šå·²å­˜æª”'); 
        };

        return { 
            currentTripId, allTrips, currentTrip, tab, tabs, curDay, 
            showAiGenerator, aiForm, vaultCategories, openTrip, 
            generateTrip, uploadVaultImgs, addAct, saveData, deleteTrip 
        };
    }
}).mount('#app');
</script>
</body>
</html>
