<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…éŠåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        [v-cloak] { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .card { background: white; border-radius: 1.5rem; border: 1px solid #f1f5f9; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

<div id="app" v-cloak class="max-w-md mx-auto min-h-screen flex flex-col bg-white shadow-2xl relative">
    
    <header class="bg-indigo-600 text-white pt-8 pb-4 px-6 sticky top-0 z-50">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-black italic">TRAVEL PRO</h1>
            <div class="flex gap-2 text-xs">
                <button @click="saveData" class="bg-green-500 px-3 py-1 rounded-full font-bold">å„²å­˜</button>
                <button @click="reset" class="bg-red-400 px-3 py-1 rounded-full">é‡è¨­</button>
            </div>
        </div>
        
        <nav class="flex overflow-x-auto gap-4 no-scrollbar border-b border-indigo-500 pb-2 text-sm font-bold">
            <button @click="tab = 'plan'" :class="tab === 'plan' ? 'text-white' : 'text-indigo-300'">è¡Œç¨‹</button>
            <button @click="tab = 'wallet'" :class="tab === 'wallet' ? 'text-white' : 'text-indigo-300'">åŒ¯ç‡/å¤©æ°£</button>
            <button @click="tab = 'vault'" :class="tab === 'vault' ? 'text-white' : 'text-indigo-300'">ä¿éšªç®±</button>
            <button @click="tab = 'pack'" :class="tab === 'pack' ? 'text-white' : 'text-indigo-300'">è¡Œæ</button>
        </nav>
    </header>

    <main class="flex-1 overflow-y-auto">
        
        <div v-if="tab === 'plan'" class="p-4">
            <div class="flex overflow-x-auto gap-2 mb-4 no-scrollbar">
                <button v-for="(day, i) in days" @click="curDay = i"
                    :class="curDay === i ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-500'"
                    class="flex-shrink-0 px-4 py-2 rounded-xl text-xs font-bold transition-all">
                    D{{ i + 1 }}
                </button>
                <button @click="addDay" class="px-4 py-2 bg-slate-100 rounded-xl text-xs">+</button>
            </div>
            <div v-for="(act, idx) in days[curDay].activities" :key="idx" class="card p-4 mb-4 relative">
                <button @click="days[curDay].activities.splice(idx, 1)" class="absolute top-4 right-4 text-slate-300">âœ•</button>
                <div class="flex gap-2 mb-2 font-bold">
                    <input type="time" v-model="act.time" class="text-indigo-600 outline-none">
                    <input v-model="act.loc" placeholder="åœ°é»" class="flex-1 outline-none border-b focus:border-indigo-400">
                </div>
                <textarea v-model="act.note" placeholder="å‚™è¨»..." class="w-full text-sm text-slate-500 outline-none mb-2" rows="1"></textarea>
                <div class="grid grid-cols-3 gap-2">
                    <div v-for="(p, pi) in act.photos" :key="pi" class="relative aspect-square">
                        <img :src="p" class="w-full h-full object-cover rounded-lg">
                        <button @click="act.photos.splice(pi,1)" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 text-[10px]">âœ•</button>
                    </div>
                    <label v-if="act.photos.length < 3" class="aspect-square border-2 border-dashed border-slate-200 rounded-lg flex items-center justify-center text-slate-300 text-xl cursor-pointer">+</label>
                    <input type="file" class="hidden" @change="uploadImg($event, 'plan', idx)">
                </div>
                <a :href="'http://maps.google.com/?q=' + act.loc" target="_blank" class="mt-2 inline-block text-[10px] text-blue-500 font-bold">ğŸ“ Google Maps</a>
            </div>
            <button @click="addAct" class="w-full py-4 border-2 border-dashed border-indigo-200 text-indigo-400 font-bold rounded-2xl text-sm">+ æ–°å¢è¡Œç¨‹é»</button>
        </div>

        <div v-if="tab === 'wallet'" class="p-6 space-y-6">
            <section class="card p-5 bg-gradient-to-br from-indigo-50 to-white">
                <h3 class="font-black mb-4 flex items-center gap-2">ğŸ’´ åŒ¯ç‡æ›ç®— (JPY â®• TWD)</h3>
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] text-slate-400 font-bold">æ—¥åœ“ JPY</label>
                        <input type="number" v-model="jpyInput" class="w-full text-2xl font-black outline-none bg-transparent border-b-2 border-indigo-200 focus:border-indigo-500">
                    </div>
                    <div class="flex items-center justify-center text-indigo-300 italic">â¬‡ æŒ‰ç•¶å‰åŒ¯ç‡ç´„ 1 : {{ rate }}</div>
                    <div>
                        <label class="text-[10px] text-slate-400 font-bold">å°å¹£ TWD</label>
                        <div class="text-2xl font-black text-indigo-600">â‰ˆ {{ (jpyInput * rate).toFixed(0) }}</div>
                    </div>
                </div>
            </section>

            <section class="card p-5">
                <h3 class="font-black mb-4 flex items-center gap-2">ğŸŒ¦ï¸ äº¬é˜ªç¥å¤©æ°£é å ±</h3>
                <div class="grid grid-cols-3 gap-2 text-center text-xs font-bold">
                    <a href="https://www.jma.go.jp/bosai/forecast/#area_code=270000" target="_blank" class="bg-blue-50 p-3 rounded-xl">å¤§é˜ª<br>é å ±</a>
                    <a href="https://www.jma.go.jp/bosai/forecast/#area_code=260000" target="_blank" class="bg-blue-50 p-3 rounded-xl">äº¬éƒ½<br>é å ±</a>
                    <a href="https://www.jma.go.jp/bosai/forecast/#area_code=280000" target="_blank" class="bg-blue-50 p-3 rounded-xl">ç¥æˆ¶<br>é å ±</a>
                </div>
                <p class="text-[10px] text-slate-400 mt-4 text-center">â€» é»æ“Šé€£çµè·³è½‰è‡³æ—¥æœ¬æ°£è±¡å»³å®˜ç¶²</p>
            </section>
        </div>

        <div v-if="tab === 'vault'" class="p-6">
            <h2 class="text-xl font-black mb-4">ğŸ” é›¢ç·šä¿éšªç®±</h2>
            <p class="text-xs text-slate-400 mb-6 font-bold">è«‹ä¸Šå‚³è­·ç…§ã€é›»å­æ©Ÿç¥¨ã€é£¯åº—ç¢ºèªå–®æˆªåœ–ï¼Œæ–·ç¶²æ™‚å¯ä¾›æŸ¥é©—ã€‚</p>
            
            <div class="grid grid-cols-1 gap-4">
                <div v-for="(v, vi) in vault" :key="vi" class="card overflow-hidden relative">
                    <img :src="v" class="w-full h-auto" @click="openImg(v)">
                    <button @click="vault.splice(vi,1)" class="absolute top-2 right-2 bg-black/50 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">âœ•</button>
                </div>
                
                <label class="w-full py-12 border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center text-slate-400 cursor-pointer hover:bg-slate-50">
                    <span class="text-3xl mb-2">ğŸ“¸</span>
                    <span class="text-xs font-bold">ä¸Šå‚³æ–°è­‰ä»¶ / æˆªåœ–</span>
                    <input type="file" class="hidden" @change="uploadImg($event, 'vault')">
                </label>
            </div>
        </div>

        <div v-if="tab === 'pack'" class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-black">ğŸ’ è¡Œææ¸…å–®</h2>
                <button @click="packs.unshift({text:'',done:false})" class="text-indigo-600 font-bold">+ æ–°å¢</button>
            </div>
            <div class="space-y-3">
                <div v-for="(p, i) in packs" :key="i" class="flex items-center gap-3 bg-white p-4 rounded-2xl border border-slate-100 shadow-sm">
                    <input type="checkbox" v-model="p.done" class="w-5 h-5 accent-indigo-600">
                    <input v-model="p.text" :class="{'line-through text-slate-300': p.done}" class="flex-1 outline-none font-medium text-sm">
                    <button @click="packs.splice(i,1)" class="text-slate-200">âœ•</button>
                </div>
            </div>
        </div>

    </main>

    <footer class="p-4 bg-slate-50 text-center text-[10px] text-slate-400 safe-bottom">
        V4.0 PRO | é›¢ç·šæ¨¡å¼é–‹å•Ÿ | æ•¸æ“šå­˜æ–¼æ‰‹æ©Ÿæœ¬åœ°
    </footer>
</div>

<script>
const { createApp, ref, onMounted } = Vue;
createApp({
    setup() {
        const tab = ref('plan');
        const curDay = ref(0);
        const days = ref([{ activities: [] }]);
        const packs = ref([{text:'è­·ç…§',done:false},{text:'æ—¥å¹£',done:false}]);
        const vault = ref([]);
        const jpyInput = ref(1000);
        const rate = ref(0.21); // é è¨­åŒ¯ç‡

        onMounted(() => {
            // è®€å–æœ¬åœ°è³‡æ–™
            const saved = localStorage.getItem('travel_final_pro');
            if (saved) {
                const d = JSON.parse(saved);
                days.value = d.days || days.value;
                packs.value = d.packs || packs.value;
                vault.value = d.vault || vault.value;
            }
            // å˜—è©¦ç²å–å³æ™‚åŒ¯ç‡ (JPY to TWD)
            fetch('https://api.exchangerate-api.com/v4/latest/JPY')
                .then(r => r.json())
                .then(data => { if(data.rates.TWD) rate.value = data.rates.TWD; })
                .catch(e => console.log('ä½¿ç”¨é è¨­åŒ¯ç‡'));
        });

        const addDay = () => { days.value.push({ activities: [] }); curDay.value = days.value.length - 1; };
        const addAct = () => days.value[curDay.value].activities.push({ time: '09:00', loc: '', note: '', photos: [] });
        
        const uploadImg = (e, type, idx) => {
            const file = e.target.files[0];
            if (file && file.size < 1500000) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    if (type === 'plan') days.value[curDay.value].activities[idx].photos.push(ev.target.result);
                    else if (type === 'vault') vault.value.push(ev.target.result);
                };
                reader.readAsDataURL(file);
            } else { alert('æª”æ¡ˆéå¤§ï¼Œè«‹ä½¿ç”¨æˆªåœ–æˆ–å°æ–¼ 1.5MB çš„åœ–ç‰‡ã€‚'); }
        };

        const saveData = () => {
            localStorage.setItem('travel_final_pro', JSON.stringify({
                days: days.value, packs: packs.value, vault: vault.value
            }));
            alert('ğŸ’¾ æ‰€æœ‰è®Šæ›´å·²å®‰å…¨å„²å­˜ï¼');
        };

        const reset = () => { if(confirm('è¦åˆªé™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) { localStorage.removeItem('travel_final_pro'); location.reload(); }};
        const openImg = (url) => window.open(url, '_blank');

        return { tab, curDay, days, packs, vault, jpyInput, rate, addDay, addAct, uploadImg, saveData, reset, openImg };
    }
}).mount('#app');
</script>
</body>
</html>