<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…éŠåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        [v-cloak] { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        body { -webkit-tap-highlight-color: transparent; }
        .tab-active { color: #4f46e5; border-bottom: 2px solid #4f46e5; }
        .line-through-text { text-decoration: line-through; color: #94a3b8; }
    </style>
</head>
<body class="bg-gray-50">

<div id="app" v-cloak class="max-w-md mx-auto min-h-screen flex flex-col bg-white shadow-lg">
    
    <header class="bg-indigo-600 text-white p-4 sticky top-0 z-50 shadow-md">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-bold">æ—…éŠåŠ©æ‰‹ ğŸ¯</h1>
            <button @click="saveData" class="bg-white text-indigo-600 px-4 py-1 rounded-full text-sm font-bold">å„²å­˜</button>
        </div>
        
        <div class="flex bg-indigo-700 rounded-lg p-1">
            <button @click="tab = 'plan'" :class="tab === 'plan' ? 'bg-white text-indigo-600' : 'text-white'" class="flex-1 py-1.5 rounded-md text-sm font-bold transition-all">è¡Œç¨‹è¦åŠƒ</button>
            <button @click="tab = 'pack'" :class="tab === 'pack' ? 'bg-white text-indigo-600' : 'text-white'" class="flex-1 py-1.5 rounded-md text-sm font-bold transition-all">è¡Œææ¸…å–®</button>
        </div>
    </header>

    <div v-if="tab === 'plan'" class="flex-1">
        <div class="flex overflow-x-auto p-3 gap-2 border-b bg-gray-50 no-scrollbar">
            <button v-for="(day, i) in days" :key="i" @click="curDay = i"
                :class="curDay === i ? 'bg-indigo-600 text-white' : 'bg-white text-gray-500 border'"
                class="flex-shrink-0 px-4 py-2 rounded-xl font-bold text-sm">
                ç¬¬ {{ i + 1 }} å¤©
            </button>
            <button @click="addDay" class="px-4 py-2 bg-green-500 text-white rounded-xl font-bold">+</button>
        </div>

        <main class="p-4 space-y-4">
            <div v-for="(act, idx) in days[curDay].activities" :key="idx" class="bg-white border border-gray-100 rounded-2xl p-4 shadow-sm relative">
                <button @click="delAct(idx)" class="absolute top-3 right-3 text-gray-300">âœ•</button>
                <div class="flex gap-2 mb-2">
                    <input type="time" v-model="act.time" class="text-indigo-600 font-bold outline-none bg-gray-50 px-1 rounded">
                    <input v-model="act.loc" placeholder="ç›®çš„åœ°" class="flex-1 font-bold outline-none border-b focus:border-indigo-400">
                </div>
                <textarea v-model="act.note" placeholder="å‚™è¨»å…§å®¹..." class="w-full text-sm text-gray-500 outline-none h-12 mb-2"></textarea>
                
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <div v-for="(p, pi) in act.photos" :key="pi" class="relative aspect-square">
                        <img :src="p" class="w-full h-full object-cover rounded-lg border">
                        <button @click="act.photos.splice(pi,1)" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 text-[10px]">âœ•</button>
                    </div>
                    <label v-if="act.photos.length < 3" class="aspect-square border-2 border-dashed border-gray-200 rounded-lg flex items-center justify-center text-gray-400 text-xl cursor-pointer">
                        +
                        <input type="file" accept="image/*" class="hidden" @change="uploadImg($event, idx)">
                    </label>
                </div>

                <a :href="'https://www.google.com/maps/search/' + encodeURIComponent(act.loc)" target="_blank" class="text-xs text-blue-500 font-bold bg-blue-50 px-2 py-1 rounded italic">ğŸ“ Google Map</a>
            </div>
            <button @click="addAct" class="w-full py-4 border-2 border-dashed border-indigo-200 text-indigo-400 font-bold rounded-2xl">+ æ–°å¢è¡Œç¨‹é»</button>
            <button @click="delDay" v-if="days.length > 1" class="w-full text-xs text-red-300 py-2">åˆªé™¤é€™æ•´å¤©çš„è¡Œç¨‹</button>
        </main>
    </div>

    <div v-if="tab === 'pack'" class="flex-1 p-4">
        <div class="flex justify-between items-center mb-4 px-2">
            <h2 class="text-lg font-bold text-gray-700">æº–å‚™æ¸…å–®</h2>
            <button @click="addPack" class="text-indigo-600 font-bold">+ æ–°å¢é …ç›®</button>
        </div>
        <div class="space-y-2">
            <div v-for="(item, i) in packs" :key="i" class="flex items-center gap-3 bg-white p-3 rounded-xl border">
                <input type="checkbox" v-model="item.done" class="w-5 h-5 accent-indigo-600">
                <input v-model="item.text" :class="{'line-through-text': item.done}" class="flex-1 outline-none text-sm font-medium">
                <button @click="packs.splice(i,1)" class="text-gray-200 text-sm">âœ•</button>
            </div>
        </div>
    </div>

    <footer class="p-4 text-center text-[10px] text-gray-400 safe-area-bottom">
        è³‡æ–™å„²å­˜æ–¼æœ¬æ©Ÿç€è¦½å™¨ | <button @click="reset">é‡è¨­æ‰€æœ‰è³‡æ–™</button>
    </footer>
</div>

<script>
const { createApp, ref, onMounted } = Vue;
createApp({
    setup() {
        const tab = ref('plan');
        const curDay = ref(0);
        const days = ref([{ activities: [] }]);
        const packs = ref([
            {text: 'è­·ç…§/ç°½è­‰', done: false}, {text: 'æ—¥å¹£ç¾é‡‘', done: false}, {text: 'å……é›»å™¨/è¡Œå‹•é›»æº', done: false}
        ]);

        onMounted(() => {
            const saved = localStorage.getItem('travel_v3');
            if (saved) {
                const data = JSON.parse(saved);
                days.value = data.days || days.value;
                packs.value = data.packs || packs.value;
            }
        });

        const addDay = () => { days.value.push({ activities: [] }); curDay.value = days.value.length - 1; };
        const delDay = () => { if(confirm('åˆªé™¤é€™å¤©ï¼Ÿ')) { days.value.splice(curDay.value, 1); curDay.value = 0; }};
        const addAct = () => days.value[curDay.value].activities.push({ time: '09:00', loc: '', note: '', photos: [] });
        const delAct = (i) => days.value[curDay.value].activities.splice(i, 1);
        const addPack = () => packs.value.unshift({ text: '', done: false });
        
        const uploadImg = (e, idx) => {
            const file = e.target.files[0];
            if (file && file.size < 1000000) {
                const reader = new FileReader();
                reader.onload = (ev) => days.value[curDay.value].activities[idx].photos.push(ev.target.result);
                reader.readAsDataURL(file);
            } else { alert('è«‹ä¸Šå‚³å°æ–¼ 1MB çš„åœ–ç‰‡'); }
        };

        const saveData = () => {
            localStorage.setItem('travel_v3', JSON.stringify({ days: days.value, packs: packs.value }));
            alert('å„²å­˜æˆåŠŸï¼');
        };

        const reset = () => { if(confirm('æ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼Ÿ')) { localStorage.removeItem('travel_v3'); location.reload(); }};

        return { tab, curDay, days, packs, addDay, delDay, addAct, delAct, addPack, uploadImg, saveData, reset };
    }
}).mount('#app');
</script>
</body>
</html>