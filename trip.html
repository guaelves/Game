<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ…¢æ—…æ—¥è¨˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&display=swap');
        [v-cloak] { display: none; }
        body { font-family: 'Noto Serif TC', serif; background-color: #f4f1ee; color: #1e293b; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .card-elegant { background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(100, 116, 139, 0.4); border-radius: 1rem; }
        .morandi-blue { background-color: #6d828a; }
        input, textarea { color: #1e293b !important; font-weight: 600; background: transparent; }
        .tab-active { border-bottom: 2px solid #1e293b; color: #000; font-weight: 700; }
        th, td { border: 1px solid #e2e8f0; padding: 6px; text-align: center; font-size: 11px; }
        th { background: #f8fafc; color: #64748b; }
    </style>
</head>
<body class="bg-[#f4f1ee]">

<div id="app" v-cloak class="max-w-md mx-auto min-h-screen flex flex-col bg-[#fdfaf7] shadow-2xl relative">
    
    <div v-if="!currentTripId" class="p-8 space-y-8">
        <header>
            <h1 class="text-3xl font-bold tracking-widest text-slate-800">æˆ‘çš„æ—…ç¨‹</h1>
            <p class="text-[10px] text-slate-500 mt-2 font-bold uppercase tracking-widest">Travel Journal Portfolio</p>
        </header>
        <div class="space-y-4">
            <div v-for="(trip, id) in allTrips" :key="id" @click="openTrip(id)"
                class="card-elegant p-6 flex justify-between items-center cursor-pointer hover:bg-white transition-all border-l-8 border-l-[#6d828a]">
                <div>
                    <h2 class="text-lg font-bold text-slate-800">{{ trip.info.title }}</h2>
                    <p class="text-xs text-slate-500 mt-1 font-bold italic">{{ trip.days.length }} Days Trip</p>
                </div>
                <span class="text-slate-300">â¯</span>
            </div>
            <button @click="createNewTrip" class="w-full py-6 border-2 border-dashed border-slate-300 rounded-2xl text-slate-500 font-bold hover:bg-white">+ é–‹å•Ÿæ–°æ—…ç¨‹è¨ˆç•«</button>
        </div>
    </div>

    <template v-else>
        <header class="pt-10 pb-4 px-8 sticky top-0 z-50 bg-[#fdfaf7]/95 backdrop-blur-md border-b border-stone-200">
            <div class="flex justify-between items-center mb-6">
                <button @click="currentTripId = null" class="text-xs font-bold text-slate-500">â® è¿”å›åˆ—è¡¨</button>
                <div class="flex gap-4">
                    <button @click="saveData" class="text-xs font-bold text-emerald-700 underline">å„²å­˜æ•¸æ“š</button>
                    <button @click="deleteTrip" class="text-xs font-bold text-rose-500">åˆªé™¤</button>
                </div>
            </div>
            <nav class="flex overflow-x-auto gap-5 no-scrollbar text-xs">
                <button v-for="(label, key) in tabs" :key="key" @click="tab = key" :class="tab === key ? 'tab-active' : ''"
                    class="pb-2 whitespace-nowrap tracking-widest font-bold text-slate-500">{{ label }}</button>
            </nav>
        </header>

        <main class="flex-1 px-4 pb-24 mt-4 overflow-y-auto">
            <div v-if="tab === 'info'" class="space-y-4">
                <div class="card-elegant p-5">
                    <label class="text-[10px] text-slate-400 font-bold uppercase">æ—…ç¨‹åç¨±</label>
                    <input v-model="currentTrip.info.title" class="w-full text-lg font-bold outline-none mt-1 border-b border-stone-100">
                </div>
                <div class="card-elegant p-5">
                    <label class="text-[10px] text-slate-400 font-bold uppercase">é£¯åº—ç´°ç¯€ HOTEL</label>
                    <textarea v-model="currentTrip.info.hotel" class="w-full text-sm font-bold outline-none mt-1" rows="2"></textarea>
                </div>
                <div class="card-elegant p-4 overflow-x-auto">
                    <label class="text-[10px] text-slate-400 font-bold uppercase mb-2 block">èˆªç­è³‡è¨Š FLIGHT</label>
                    <table class="w-full border-collapse">
                        <thead>
                            <tr>
                                <th>è¡Œç¨‹</th><th>æ—¥æœŸ</th><th>æ™‚é–“</th><th>åœ°é»</th><th>èˆªå»ˆ</th><th>èˆªç­</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="f in ['go', 'back']">
                                <td class="font-bold text-slate-500">{{ f === 'go' ? 'å»ç¨‹' : 'å›ç¨‹' }}</td>
                                <td><input v-model="currentTrip.flightData[f].date" class="w-full text-center text-[10px]"></td>
                                <td><input v-model="currentTrip.flightData[f].time" class="w-full text-center text-[10px]"></td>
                                <td><input v-model="currentTrip.flightData[f].loc" class="w-full text-center text-[10px]"></td>
                                <td><input v-model="currentTrip.flightData[f].terminal" class="w-full text-center text-[10px]"></td>
                                <td><input v-model="currentTrip.flightData[f].no" class="w-full text-center text-[10px]"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div v-if="tab === 'plan'" class="space-y-4">
                <div class="flex gap-2 overflow-x-auto no-scrollbar py-2">
                    <button v-for="(day, i) in currentTrip.days" @click="curDay = i"
                        :class="curDay === i ? 'morandi-blue text-white shadow-md' : 'bg-stone-200 text-slate-600'"
                        class="flex-shrink-0 w-10 h-10 rounded-full text-xs font-bold">D{{i+1}}</button>
                    <button @click="addDay" class="flex-shrink-0 w-10 h-10 border-2 border-dashed border-slate-300 rounded-full text-slate-500">+</button>
                </div>

                <div v-for="(act, idx) in currentTrip.days[curDay].activities" :key="idx" class="card-elegant p-4 relative">
                    <button @click="currentTrip.days[curDay].activities.splice(idx, 1)" class="absolute top-2 right-2 text-slate-300 font-bold">âœ•</button>
                    <div class="flex items-center gap-2 mb-2">
                        <input v-model="act.time" class="w-12 text-slate-800 font-bold outline-none text-sm" placeholder="æ™‚é–“">
                        <div class="flex-1 flex items-center border-b border-stone-200">
                            <input v-model="act.loc" class="flex-1 font-bold outline-none text-sm py-1" placeholder="åœ°é»åç¨±">
                            <a v-if="act.loc" :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(act.loc)" target="_blank" class="ml-1 text-[10px] text-blue-700 font-bold flex items-center whitespace-nowrap">
                                ğŸ“åœ°åœ–
                            </a>
                        </div>
                    </div>
                    <textarea v-model="act.note" class="w-full text-[11px] text-slate-600 font-bold outline-none mb-2" placeholder="è¡Œç¨‹ç­†è¨˜..."></textarea>
                    
                    <div class="grid grid-cols-3 gap-2">
                        <div v-for="(p, pi) in act.photos" :key="pi" class="relative aspect-square">
                            <img :src="p" class="w-full h-full object-cover rounded-md">
                            <button @click="act.photos.splice(pi,1)" class="absolute -top-1 -right-1 bg-rose-500 text-white rounded-full w-4 h-4 text-[10px]">âœ•</button>
                        </div>
                        <label v-if="act.photos.length < 3" class="aspect-square border-2 border-dashed border-stone-200 rounded-md flex items-center justify-center text-slate-300 cursor-pointer">
                            <span class="text-xl">+</span>
                            <input type="file" class="hidden" accept="image/*" @change="uploadActImg($event, idx)">
                        </label>
                    </div>
                </div>
                <button @click="addAct" class="w-full py-4 rounded-xl border-2 border-dashed border-slate-300 text-slate-400 font-bold text-xs">+ æ–°å¢ D{{curDay+1}} é …ç›®</button>
            </div>

            <div v-if="tab === 'vault'" class="space-y-6">
                <div v-for="cat in vaultCategories" :key="cat.key" class="space-y-3">
                    <h3 class="text-xs font-black text-slate-500 border-l-4 border-l-slate-400 pl-2 uppercase tracking-widest">{{ cat.label }}</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="(img, ii) in currentTrip.vault[cat.key]" :key="ii" class="relative">
                            <img :src="img" class="w-full aspect-video object-cover rounded-lg shadow-sm" @click="openImg(img)">
                            <button @click="currentTrip.vault[cat.key].splice(ii,1)" class="absolute -top-1 -right-1 bg-black text-white rounded-full w-5 h-5 text-xs">âœ•</button>
                        </div>
                        <label class="aspect-video border-2 border-dashed border-stone-200 rounded-lg flex flex-col items-center justify-center bg-white cursor-pointer text-slate-400">
                            <span class="text-lg font-bold">+</span>
                            <span class="text-[9px] font-bold">ä¸Šå‚³</span>
                            <input type="file" class="hidden" accept="image/*" @change="uploadVaultImg($event, cat.key)">
                        </label>
                    </div>
                </div>
            </div>

            <div v-if="tab === 'pack'" class="space-y-4">
                <div class="flex justify-between items-center px-1">
                    <h3 class="text-xs font-bold text-slate-400 tracking-widest uppercase">Packing List</h3>
                    <button @click="copyPreviousPacks" class="text-[10px] bg-slate-200 px-2 py-1 rounded font-bold text-slate-600">å¾ä¹‹å‰çš„è¡Œç¨‹è¤‡è£½æ¸…å–®</button>
                </div>
                <div class="card-elegant p-4">
                    <div v-for="(p, i) in currentTrip.packs" :key="i" class="flex items-center gap-3 py-2 border-b border-stone-50 last:border-0">
                        <input type="checkbox" v-model="p.done" class="w-4 h-4 accent-slate-700">
                        <input v-model="p.text" class="flex-1 outline-none text-sm font-bold" :class="p.done ? 'line-through text-slate-300':''">
                        <button @click="currentTrip.packs.splice(i,1)" class="text-slate-200 font-bold">âœ•</button>
                    </div>
                    <button @click="currentTrip.packs.push({text:'',done:false})" class="mt-4 text-xs text-slate-400 font-bold">+ æ‰‹å‹•æ–°å¢é …ç›®</button>
                </div>
            </div>
        </main>

        <footer class="fixed bottom-0 left-0 right-0 p-4 bg-[#fdfaf7]/95 text-center border-t border-stone-100">
            <p class="text-[10px] text-slate-400 font-bold tracking-[0.2em] uppercase">COLLECT MOMENTS â€” Travel Pro V4</p>
        </footer>
    </template>
</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

createApp({
    setup() {
        const currentTripId = ref(null);
        const allTrips = ref({});
        const tab = ref('info');
        const curDay = ref(0);
        
        const tabs = { info: 'è¡Œç¨‹æ¦‚è¦½', plan: 'æ—¥éŠè¦åŠƒ', vault: 'æ–‡ä»¶å‚™ä»½', pack: 'è¡Œææ¸…å–®' };
        const vaultCategories = [
            { label: 'æ©Ÿç¥¨æ–‡ä»¶ Flight', key: 'flight' }, { label: 'é£¯åº—æ–‡ä»¶ Hotel', key: 'hotel' },
            { label: 'VJW ç”³è«‹ (å¤šäºº)', key: 'vjw' }, { label: 'ä¿éšªè­‰æ˜ Insurance', key: 'insurance' },
            { label: 'æ™¯é»é–€ç¥¨ Tickets', key: 'tickets' }
        ];

        const currentTrip = computed(() => allTrips.value[currentTripId.value]);

        // ç¯„ä¾‹è³‡æ–™
        const okinawaDemo = {
            info: { title: '2025 OKINAWA æ²–ç¹©æ—…éŠ', hotel: 'ãƒ›ãƒ†ãƒ« ã‚ªãƒ¼ã‚·ãƒ£ãƒ³é‚£éœ¸å›½éš›é€šãƒª' },
            flightData: {
                go: { date: '2025/5/5', time: '15:00', loc: 'TPEâ†’OKA', terminal: 'T1', no: 'ITXXX' },
                back: { date: '2025/5/10', time: '16:45', loc: 'OKAâ†’TPE', terminal: 'åœ‹éš›', no: 'ITXXX' }
            },
            days: [
                { activities: [{time:'09:00', loc:'æ©Ÿå ´æ¥é€', note:'å‡ºç™¼', photos:[]}, {time:'15:00', loc:'é£›æ©Ÿ', note:'TPE->OKA', photos:[]}] },
                { activities: [{time:'09:00', loc:'é‚£éœ¸ç©ºæ¸¯å–è»Š', note:'é‚£éœ¸ç©ºæ¸¯é£›è¦‹åŸåº—', photos:[]}, {time:'10:00', loc:'ç³»æ»¿å¸‚å ´', note:'', photos:[]}] },
                { activities: [{time:'10:00', loc:'ç¾éº—æµ·æ°´æ—é¤¨', note:'', photos:[]}, {time:'16:00', loc:'ç¾åœ‹æ‘', note:'', photos:[]}] },
                { activities: [{time:'13:00', loc:'å°ç£å°åƒã€ŒèŠ±è“®ã€', note:'å®œé‡ç£å¸‚å–œå‹å1039', photos:[]}, {time:'19:00', loc:'é‚„è»Š', note:'', photos:[]}] },
                { activities: [{time:'09:00', loc:'æ³¢ä¸Šå®®', note:'', photos:[]}, {time:'17:00', loc:'åœ‹éš›é€š ã¶ã¡ç‡’è‚‰', note:'', photos:[]}] },
                { activities: [{time:'11:00', loc:'é‚£éœ¸æ©Ÿå ´', note:'', photos:[]}, {time:'16:45', loc:'èµ·é£›', note:'', photos:[]}] }
            ],
            vault: { flight: [], hotel: [], vjw: [], insurance: [], tickets: [] },
            packs: [
                {text:'è­·ç…§ã€èº«åˆ†è­‰ã€æ—¥å¹£ã€å°å¹£', done:false}, {text:'è¥¿ç“œå¡ã€ä¿¡ç”¨å¡ã€è»Šç¥¨', done:false},
                {text:'ä¿é¤Šå“ã€éš±çœ¼ã€çœ¼é¡ç›’', done:false}, {text:'æ°´å£ºã€è‡ªæ‹æ£’ã€è¡Œå‹•é›»æº', done:false},
                {text:'é§•ç…§è­¯æœ¬ã€æ©Ÿå ´æ¥é€é ç´„', done:false}
            ]
        };

        onMounted(() => {
            const saved = localStorage.getItem('travel_v4_data');
            if (saved) {
                allTrips.value = JSON.parse(saved);
            } else {
                allTrips.value['trip_okinawa'] = okinawaDemo;
            }
        });

        const openTrip = (id) => { currentTripId.value = id; curDay.value = 0; tab.value = 'info'; };
        
        const createNewTrip = () => {
            const id = 'trip_' + Date.now();
            allTrips.value[id] = {
                info: {title:'æ–°è¡Œç¨‹', hotel:''},
                flightData: {
                    go: { date:'', time:'', loc:'', terminal:'', no:'' },
                    back: { date:'', time:'', loc:'', terminal:'', no:'' }
                },
                days: [{activities:[]}],
                vault: {flight:[], hotel:[], vjw:[], insurance:[], tickets:[]},
                packs: []
            };
            currentTripId.value = id;
        };

        const copyPreviousPacks = () => {
            const tripIds = Object.keys(allTrips.value).filter(id => id !== currentTripId.value);
            if (tripIds.length === 0) { alert('æ²’æœ‰å…¶ä»–è¡Œç¨‹å¯ä»¥è¤‡è£½'); return; }
            const lastTrip = allTrips.value[tripIds[tripIds.length-1]];
            if (confirm(`æ˜¯å¦è¦è¤‡è£½ã€Œ${lastTrip.info.title}ã€çš„è¡Œææ¸…å–®ï¼Ÿ`)) {
                currentTrip.value.packs = JSON.parse(JSON.stringify(lastTrip.packs)).map(p => ({...p, done: false}));
            }
        };

        const deleteTrip = () => { if(confirm('ç¢ºå®šåˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) { delete allTrips.value[currentTripId.value]; currentTripId.value = null; saveData(); } };
        const addDay = () => { currentTrip.value.days.push({activities:[]}); curDay.value = currentTrip.value.days.length - 1; };
        const addAct = () => { currentTrip.value.days[curDay.value].activities.push({time:'', loc:'', note:'', photos:[]}); };
        
        const uploadActImg = (e, actIdx) => {
            const file = e.target.files[0];
            if (file && currentTrip.value.days[curDay.value].activities[actIdx].photos.length < 3) {
                const reader = new FileReader();
                reader.onload = (ev) => { currentTrip.value.days[curDay.value].activities[actIdx].photos.push(ev.target.result); };
                reader.readAsDataURL(file);
            }
        };

        const uploadVaultImg = (e, key) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => { currentTrip.value.vault[key].push(ev.target.result); };
                reader.readAsDataURL(file);
            }
        };

        const saveData = () => { localStorage.setItem('travel_v4_data', JSON.stringify(allTrips.value)); alert('ğŸ’¾ å·²å­˜æª”'); };
        const openImg = (url) => { const n = window.open(); n.document.write(`<body style="margin:0;background:#000;display:flex;align-items:center;justify-content:center"><img src="${url}" style="max-width:100%"></body>`); };

        return { currentTripId, allTrips, currentTrip, tab, tabs, curDay, vaultCategories, openTrip, createNewTrip, copyPreviousPacks, deleteTrip, addDay, addAct, uploadActImg, uploadVaultImg, saveData, openImg };
    }
}).mount('#app');
</script>
</body>
</html>