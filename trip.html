<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…éŠåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22æ—…éŠåŠ©æ‰‹%22,%22short_name%22:%22æ—…éŠåŠ©æ‰‹%22,%22display%22:%22standalone%22,%22start_url%22:%22.%22,%22background_color%22:%22#f8fafc%22,%22theme_color%22:%22#4f46e5%22}">
    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; }
        .photo-item { position: relative; aspect-ratio: 1; border-radius: 12px; overflow: hidden; background: #f1f5f9; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        .safe-bottom { padding-bottom: calc(1rem + env(safe-area-inset-bottom)); }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

<div id="app" v-cloak class="max-w-md mx-auto min-h-screen flex flex-col">
    <header class="bg-indigo-600 text-white p-6 shadow-lg sticky top-0 z-50">
        <div class="flex justify-between items-center">
            <h1 class="text-2xl font-black tracking-tight">æ—…éŠåŠ©æ‰‹</h1>
            <div class="flex gap-2">
                <button @click="exportData" class="text-xs bg-white/20 p-2 rounded-full">ğŸ“¤ åŒ¯å‡º</button>
                <button @click="saveData" class="text-xs bg-white text-indigo-600 px-3 py-2 rounded-full font-bold">å„²å­˜</button>
            </div>
        </div>
        <div class="mt-4 flex items-center gap-2">
            <span class="text-indigo-200 text-sm font-medium">å‡ºç™¼æ—¥æœŸï¼š</span>
            <input type="date" v-model="startDate" class="bg-indigo-700/50 border-none rounded-lg px-2 py-1 text-sm outline-none">
        </div>
    </header>

    <div class="bg-white border-b sticky top-[108px] z-40 overflow-x-auto hide-scrollbar flex p-3 gap-2">
        <button v-for="(day, index) in days" :key="index"
            @click="currentDayIndex = index"
            :class="currentDayIndex === index ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-100 text-slate-500'"
            class="flex-shrink-0 px-6 py-2 rounded-full font-bold transition-all text-sm">
            ç¬¬ {{ index + 1 }} å¤©
        </button>
        <button @click="addDay" class="bg-indigo-50 text-indigo-600 px-4 py-2 rounded-full font-bold text-sm">+</button>
    </div>

    <main class="flex-1 p-4 pb-32">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-slate-800">Day {{ currentDayIndex + 1 }} è¡Œç¨‹æ¸…å–®</h2>
            <button @click="removeDay" v-if="days.length > 1" class="text-red-400 text-xs hover:underline">åˆªé™¤æœ¬æ—¥</button>
        </div>

        <div v-for="(item, idx) in days[currentDayIndex].activities" :key="idx" 
             class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4 mb-4">
            
            <div class="flex justify-between items-start gap-2 mb-3">
                <input v-model="item.time" type="time" class="text-indigo-600 font-bold outline-none border-b border-transparent focus:border-indigo-100">
                <button @click="removeItem(idx)" class="text-slate-300 hover:text-red-500">âœ•</button>
            </div>

            <input v-model="item.location" placeholder="è¦å»å“ªè£¡ï¼Ÿ(å¦‚ï¼šæ¸…æ°´å¯º)" 
                   class="w-full text-lg font-bold mb-2 outline-none placeholder:text-slate-300">
            
            <textarea v-model="item.note" placeholder="å‚™è¨»ï¼šè¨‚å–®ç·¨è™Ÿã€å¿…è²·æ¸…å–®..." 
                      class="w-full text-sm text-slate-500 mb-3 outline-none resize-none" rows="2"></textarea>

            <div class="photo-grid mb-3">
                <div v-for="(img, imgIdx) in item.photos" :key="imgIdx" class="photo-item">
                    <img :src="img" @click="viewImage(img)">
                    <button @click="removePhoto(idx, imgIdx)" class="absolute top-1 right-1 bg-black/50 text-white rounded-full w-5 h-5 text-[10px]">âœ•</button>
                </div>
                <label v-if="item.photos.length < 6" class="photo-item flex flex-col items-center justify-center border-2 border-dashed border-slate-200 cursor-pointer">
                    <span class="text-xl text-slate-300">+</span>
                    <span class="text-[10px] text-slate-400">ä¸Šå‚³/æ‹ç…§</span>
                    <input type="file" accept="image/*" class="hidden" @change="handleFileUpload($event, idx)">
                </label>
            </div>

            <div class="flex gap-2">
                <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location)" 
                   target="_blank" class="text-xs flex items-center bg-blue-50 text-blue-600 px-3 py-2 rounded-lg font-bold">
                    ğŸ“ é–‹å•Ÿåœ°åœ–
                </a>
            </div>
        </div>

        <button @click="addActivity" class="w-full py-5 border-2 border-dashed border-indigo-200 rounded-2xl text-indigo-400 font-bold hover:bg-indigo-50 transition-colors mt-2">
            + æ–°å¢è¡Œç¨‹åœ°é»
        </button>
    </main>

    <footer class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-slate-100 px-6 py-4 safe-bottom">
        <div class="max-w-md mx-auto flex justify-between items-center text-xs font-bold text-slate-400">
            <p>è³‡æ–™å„²å­˜æ–¼æ‰‹æ©Ÿæœ¬åœ°</p>
            <button @click="clearAll" class="text-red-300">æ¸…ç©ºæ‰€æœ‰è¡Œç¨‹</button>
        </div>
    </footer>
</div>

<script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
        setup() {
            const startDate = ref('2026-04-01');
            const currentDayIndex = ref(0);
            const days = ref([]);

            const defaultTrip = [
                { activities: [
                    { time: '10:00', location: 'é—œè¥¿åœ‹éš›æ©Ÿå ´', note: 'é ˜å–å‘¨éŠåˆ¸', photos: [] },
                    { time: '15:00', location: 'å¿ƒé½‹æ©‹', note: 'åƒç« é­šç‡’', photos: [] }
                ]},
                { activities: [{ time: '09:00', location: 'æ¸…æ°´å¯º', note: 'ç©¿å’Œæœ', photos: [] }] },
                { activities: [{ time: '10:00', location: 'æ—¥æœ¬ç’°çƒå½±åŸ', note: 'ä»»å¤©å ‚åœ’å€', photos: [] }] },
                { activities: [{ time: '11:00', location: 'é»‘é–€å¸‚å ´', note: 'è²·å¹²è²', photos: [] }] }
            ];

            onMounted(() => {
                const saved = localStorage.getItem('travel_assistant_v1');
                days.value = saved ? JSON.parse(saved) : defaultTrip;
            });

            const addDay = () => {
                days.value.push({ activities: [] });
                currentDayIndex.value = days.value.length - 1;
            };

            const removeDay = () => {
                if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å¤©çš„æ‰€æœ‰è¡Œç¨‹å—ï¼Ÿ')) {
                    days.value.splice(currentDayIndex.value, 1);
                    currentDayIndex.value = 0;
                }
            };

            const addActivity = () => {
                days.value[currentDayIndex.value].activities.push({
                    time: '12:00', location: '', note: '', photos: []
                });
            };

            const removeItem = (idx) => {
                days.value[currentDayIndex.value].activities.splice(idx, 1);
            };

            const handleFileUpload = (event, activityIdx) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    // ç‚ºäº†æ•ˆèƒ½ï¼Œé€™è£¡å¯ä»¥åŠ å…¥åœ–ç‰‡å£“ç¸®é‚è¼¯
                    days.value[currentDayIndex.value].activities[activityIdx].photos.push(e.target.result);
                };
                reader.readAsDataURL(file);
            };

            const removePhoto = (actIdx, imgIdx) => {
                days.value[currentDayIndex.value].activities[actIdx].photos.splice(imgIdx, 1);
            };

            const saveData = () => {
                try {
                    localStorage.setItem('travel_assistant_v1', JSON.stringify(days.value));
                    alert('è¡Œç¨‹å·²å®‰å…¨å„²å­˜ï¼');
                } catch (e) {
                    alert('å„²å­˜å¤±æ•—ï¼šç…§ç‰‡æª”æ¡ˆéå¤§ï¼Œè«‹åˆªé™¤éƒ¨åˆ†ç…§ç‰‡å¾Œå†è©¦ã€‚');
                }
            };

            const exportData = () => {
                const dataStr = JSON.stringify(days.value);
                const blob = new Blob([dataStr], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `æˆ‘çš„è¡Œç¨‹_${new Date().toLocaleDateString()}.json`;
                a.click();
            };

            const clearAll = () => {
                if(confirm('è­¦å‘Šï¼šé€™å°‡åˆªé™¤æ‰€æœ‰å·²å„²å­˜çš„è¡Œç¨‹èˆ‡ç…§ç‰‡ã€‚ç¢ºå®šå—ï¼Ÿ')) {
                    localStorage.removeItem('travel_assistant_v1');
                    location.reload();
                }
            };

            const viewImage = (url) => {
                window.open(url, '_blank');
            };

            return { 
                startDate, days, currentDayIndex, addDay, removeDay, 
                addActivity, removeItem, handleFileUpload, removePhoto, 
                saveData, exportData, clearAll, viewImage 
            };
        }
    }).mount('#app');
</script>
</body>
</html>